<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Adjusted Pace</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: auto;
            background-color: #f5f5f5;
        }
        .container {
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
            background-color: white;
            animation: fadeIn 1s ease-in-out;
            margin: 20px 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        h1 {
            font-size: 24px;
            animation: slideDown 1.5s ease-in-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        label {
            display: block;
            margin-top: 10px;
            text-align: left;
        }
        input, select, button {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        input, select {
            background-color: #EDEDED;
        }
        button {
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            color: white;
        }
        button:hover {
            transform: scale(1.05);
        }
        #result, .weather-info {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            text-align: left;
        }
        .credits {
            margin-top: 20px;
            font-size: 8px;
        }
        .credits a {
            text-decoration: none;
        }
        .credits a:hover {
            text-decoration: underline;
        }
        .explanation, .methodology {
            margin-top: 20px;
            font-size: 9px;
            text-align: left;
            color: #333;
        }
        #chartContainer {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }
    </style>
</head>
<body onload="applyTheme()">
    <div class="container">
        <h1>üèÉ‚Äç‚ôÇÔ∏è Heat Adjusted Pace ü•µ</h1>
        <form id="pace-form">
            <label for="goalPace">Goal Pace in Ideal Conditions (min/mile):</label>
            <input type="text" id="goalPace" name="goalPace" value="08:30" required><br>
            <label for="expectedTime">Time of Day (HH:MM):</label>
            <input type="text" id="expectedTime" name="expectedTime" value="07:00" required><br>
            <label for="date">Date (YYYY-MM-DD):</label>
            <input type="date" id="date" name="date" required><br>
            <label for="zipCode">Zip Code:</label>
            <input type="text" id="zipCode" name="zipCode" required><br>
            <label for="acclimatizationHours">Average Hours Running in Heat/Week (Last 2 Weeks):</label>
            <input type="number" id="acclimatizationHours" name="acclimatizationHours" value="0" step="0.1" required><br>
            <label for="hydrationStatus">Hydration Status:</label>
            <select id="hydrationStatus" name="hydrationStatus" required>
                <option value="well">Well Hydrated</option>
                <option value="moderate">Moderately Hydrated</option>
                <option value="poor">Poorly Hydrated</option>
            </select><br>
            <label for="workoutLength">Length of Workout (minutes):</label>
            <input type="number" id="workoutLength" name="workoutLength" value="60" required><br>
            <button type="button" onclick="calculateHourlyPaces()">Calculate Adjusted Pace</button>
        </form>
        <div id="result"></div>
        <div id="weather-info" class="weather-info"></div>
        <div id="chartContainer">
            <canvas id="adjustmentChart"></canvas>
        </div>
        <div class="explanation">
            <h2>Why Adjust Your Pace?</h2>
            <p>Adjust your pace so that your workout remains aerobically equivalent and safe, even in challenging weather conditions.</p>
            <p>Adjusting your running pace based on weather conditions such as temperature and humidity is crucial for maintaining optimal performance and preventing overheating. The combination of high temperature and humidity can significantly increase the physiological stress on your body, making the same pace much harder to maintain.</p>
            <p>This is just an estimate; conditions affect people differently.</p>
        </div>
        <div class="methodology">
            <h2>Methodology and Calculations</h2>
            <p>This tool adjusts your running pace based on several key factors to ensure you can maintain a safe and effective workout. Here's how the calculations are done:</p>
            <ul>
                <li><strong>Dew Point Calculation:</strong> The dew point is calculated using the temperature and humidity to determine the combined heat stress on your body.</li>
                <li><strong>Base Adjustment:</strong> The base adjustment factor is determined from the combined temperature and dew point, reflecting how much these conditions typically slow you down.</li>
                <li><strong>Acclimatization Score:</strong> Based on your average hours of running in the heat per week over the last 2 weeks, an acclimatization score is calculated. More hours indicate better adaptation and a lower adjustment factor.</li>
                <li><strong>Wind Adjustment:</strong> Wind speed is factored in to adjust your pace, accounting for additional cooling from the wind.</li>
                <li><strong>UV Index Adjustment:</strong> The UV index is used to account for the added stress of direct sunlight exposure.</li>
                <li><strong>Interaction Effects:</strong> Adjustments are made to account for interactions between factors, such as the enhanced cooling effect of wind in hotter conditions and the compounding effects of high temperature and humidity.</li>
                <li><strong>Hydration Adjustment:</strong> Hydration status is used to adjust pace, with poorer hydration leading to a higher adjustment factor.</li>
                <li><strong>Workout Length Adjustment:</strong> Longer workouts lead to higher adjustment factors due to the increased stress on the body over time.</li>
            </ul>
            <p>The overall adjustment is applied to your goal pace to give you an adjusted pace that maintains the same effort level under the current conditions.</p>
        </div>
        <div class="credits">
            <p>Created by <a href="https://www.strava.com/athletes/113202952" target="_blank">J‚òÄÔ∏è Traum</a></p>
            <p>Sources:</p>
            <ul>
                <li><a href="http://maximumperformancerunning.blogspot.com/2013/07/temperature-dew-point.html" target="_blank">Maximum Performance Running</a></li>
                <li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9237513/" target="_blank">Impact of environmental heat stress on physiology, performance, and recovery in endurance sports</a></li>
                <li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8677617/" target="_blank">Effect of heat acclimation on pacing strategy and performance in endurance runners</a></li>
                <li><a href="https://link.springer.com/content/pdf/10.1007/s42978-024-00283-y.pdf" target="_blank">The influence of environmental temperature on marathon running performance</a></li>
            </ul>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Adjusted Pace</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: auto;
            background-color: #f5f5f5;
        }
        .container {
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
            background-color: white;
            animation: fadeIn 1s ease-in-out;
            margin: 20px 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        h1 {
            font-size: 24px;
            animation: slideDown 1.5s ease-in-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        label {
            display: block;
            margin-top: 10px;
            text-align: left;
        }
        input, select, button {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        input, select {
            background-color: #EDEDED;
        }
        button {
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            color: white;
        }
        button:hover {
            transform: scale(1.05);
        }
        #result, .weather-info {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            text-align: left;
        }
        .credits {
            margin-top: 20px;
            font-size: 8px;
        }
        .credits a {
            text-decoration: none;
        }
        .credits a:hover {
            text-decoration: underline;
        }
        .explanation, .methodology {
            margin-top: 20px;
            font-size: 9px;
            text-align: left;
            color: #333;
        }
        #chartContainer {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }
    </style>
</head>
<body onload="applyTheme()">
    <div class="container">
        <h1>üèÉ‚Äç‚ôÇÔ∏è Heat Adjusted Pace ü•µ</h1>
        <form id="pace-form">
            <label for="goalPace">Goal Pace in Ideal Conditions (min/mile):</label>
            <input type="text" id="goalPace" name="goalPace" value="08:30" required><br>
            <label for="expectedTime">Time of Day (HH:MM):</label>
            <input type="text" id="expectedTime" name="expectedTime" value="07:00" required><br>
            <label for="date">Date (YYYY-MM-DD):</label>
            <input type="date" id="date" name="date" required><br>
            <label for="zipCode">Zip Code:</label>
            <input type="text" id="zipCode" name="zipCode" required><br>
            <label for="acclimatizationHours">Average Hours Running in Heat/Week (Last 2 Weeks):</label>
            <input type="number" id="acclimatizationHours" name="acclimatizationHours" value="0" step="0.1" required><br>
            <label for="hydrationStatus">Hydration Status:</label>
            <select id="hydrationStatus" name="hydrationStatus" required>
                <option value="well">Well Hydrated</option>
                <option value="moderate">Moderately Hydrated</option>
                <option value="poor">Poorly Hydrated</option>
            </select><br>
            <label for="workoutLength">Length of Workout (minutes):</label>
            <input type="number" id="workoutLength" name="workoutLength" value="60" required><br>
            <button type="button" id="calculateButton" onclick="calculateHourlyPaces()">Calculate Adjusted Pace</button>
        </form>
        <div id="result"></div>
        <div id="weather-info" class="weather-info"></div>
        <div id="chartContainer">
            <canvas id="adjustmentChart"></canvas>
        </div>
        <div class="explanation">
            <h2>Why Adjust Your Pace?</h2>
            <p>Adjust your pace so that your workout remains aerobically equivalent and safe, even in challenging weather conditions.</p>
            <p>Adjusting your running pace based on weather conditions such as temperature and humidity is crucial for maintaining optimal performance and preventing overheating. The combination of high temperature and humidity can significantly increase the physiological stress on your body, making the same pace much harder to maintain.</p>
            <p>This is just an estimate; conditions affect people differently.</p>
        </div>
        <div class="methodology">
            <h2>Methodology and Calculations</h2>
            <p>This tool adjusts your running pace based on several key factors to ensure you can maintain a safe and effective workout. Here's how the calculations are done:</p>
            <ul>
                <li><strong>Dew Point Calculation:</strong> The dew point is calculated using the temperature and humidity to determine the combined heat stress on your body.</li>
                <li><strong>Base Adjustment:</strong> The base adjustment factor is determined from the combined temperature and dew point, reflecting how much these conditions typically slow you down.</li>
                <li><strong>Acclimatization Score:</strong> Based on your average hours of running in the heat per week over the last 2 weeks, an acclimatization score is calculated. More hours indicate better adaptation and a lower adjustment factor.</li>
                <li><strong>Wind Adjustment:</strong> Wind speed is factored in to adjust your pace, accounting for additional cooling from the wind.</li>
                <li><strong>UV Index Adjustment:</strong> The UV index is used to account for the added stress of direct sunlight exposure.</li>
                <li><strong>Interaction Effects:</strong> Adjustments are made to account for interactions between factors, such as the enhanced cooling effect of wind in hotter conditions and the compounding effects of high temperature and humidity.</li>
                <li><strong>Hydration Adjustment:</strong> Hydration status is used to adjust pace, with poorer hydration leading to a higher adjustment factor.</li>
                <li><strong>Workout Length Adjustment:</strong> Longer workouts lead to higher adjustment factors due to the increased stress on the body over time.</li>
            </ul>
            <p>The overall adjustment is applied to your goal pace to give you an adjusted pace that maintains the same effort level under the current conditions.</p>
        </div>
        <div class="credits">
            <p>Created by <a href="https://www.strava.com/athletes/113202952" target="_blank">J‚òÄÔ∏è Traum</a></p>
            <p>Sources:</p>
            <ul>
                <li><a href="http://maximumperformancerunning.blogspot.com/2013/07/temperature-dew-point.html" target="_blank">Maximum Performance Running</a></li>
                <li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9237513/" target="_blank">Impact of environmental heat stress on physiology, performance, and recovery in endurance sports</a></li>
                <li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8677617/" target="_blank">Effect of heat acclimation on pacing strategy and performance in endurance runners</a></li>
                <li><a href="https://link.springer.com/content/pdf/10.1007/s42978-024-00283-y.pdf" target="_blank">The influence of environmental temperature on marathon running performance</a></li>
            </ul>
        </div>
    </div>
    <script>
        async function fetchHourlyWeatherData(zipCode) {
            const response = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=2beb72048c714687af713040240506&q=${zipCode}&days=1&hour=1`);
            const data = await response.json();
            return data.forecast.forecastday[0].hour;
        }

        function calculateDewPoint(temp, humidity) {
            const a = 17.27;
            const b = 237.7;
            const alpha = ((a * temp) / (b + temp)) + Math.log(humidity / 100);
            const dewPoint = (b * alpha) / (a - alpha);
            return dewPoint;
        }

        function getBaseAdjustment(temp, dewPoint) {
            const combined = temp + dewPoint;
            if (combined <= 100) return 0;
            if (combined <= 110) return 0.005;
            if (combined <= 120) return 0.01;
            if (combined <= 130) return 0.02;
            if (combined <= 140) return 0.03;
            if (combined <= 150) return 0.045;
            if (combined <= 160) return 0.06;
            if (combined <= 170) return 0.08;
            return 0.1;
        }

        function calculateAcclimatizationScore(hoursPerWeek) {
            if (hoursPerWeek >= 7) return 0.5; // High acclimatization
            if (hoursPerWeek >= 4) return 0.75; // Moderate acclimatization
            return 1; // Low acclimatization
        }

        function applyWindAdjustment(adjustment, windSpeed, temp) {
            if (temp >= 80) {
                if (windSpeed > 10) adjustment -= 0.02;
                else if (windSpeed > 5) adjustment -= 0.01;
            } else if (temp >= 60) {
                if (windSpeed > 10) adjustment -= 0.01;
                else if (windSpeed > 5) adjustment -= 0.005;
            } else {
                if (windSpeed > 10) adjustment -= 0.005;
                else if (windSpeed > 5) adjustment -= 0.0025;
            }
            return adjustment;
        }

        function applyUVAdjustment(adjustment, uvIndex) {
            if (uvIndex > 8) adjustment += 0.01;
            else if (uvIndex > 6) adjustment += 0.005;
            return adjustment;
        }

        function applyInteractionEffects(adjustment, temp, humidity, uvIndex, windSpeed, acclimatizationScore) {
            // Temperature and Humidity Interaction
            if (temp > 80 && humidity > 60) adjustment += 0.01;
            if (temp > 90 && humidity > 70) adjustment += 0.02;

            // Temperature and UV Index Interaction
            if (temp > 80 && uvIndex > 6) adjustment += 0.01;
            if (temp > 90 && uvIndex > 8) adjustment += 0.02;

            // Wind and Temperature Interaction
            if (temp > 80) {
                if (windSpeed > 10) adjustment -= 0.02;
                else if (windSpeed > 5) adjustment -= 0.01;
            }

            // Acclimatization Interaction
            adjustment *= acclimatizationScore;

            return adjustment;
        }

        function calculateHydrationAdjustment(hydrationStatus) {
            if (hydrationStatus === 'well') return 1;
            if (hydrationStatus === 'moderate') return 1.05;
            if (hydrationStatus === 'poor') return 1.1;
        }

        function calculateWorkoutLengthAdjustment(length) {
            if (length > 90) return 1.05;
            if (length > 60) return 1.03;
            return 1;
        }

        function calculateHourlyAdjustments(goalPace, hourlyData, acclimatizationHours, hydrationStatus, workoutLength) {
            const adjustments = hourlyData.filter((_, index) => index % 2 === 0).map(hour => {
                const temp = hour.temp_f;
                const humidity = hour.humidity;
                const windSpeed = hour.wind_mph;
                const uvIndex = hour.uv;
                const time = hour.time;

                const dewPoint = calculateDewPoint(temp, humidity);
                let adjustment = getBaseAdjustment(temp, dewPoint);

                const acclimatizationScore = calculateAcclimatizationScore(acclimatizationHours);

                adjustment = applyWindAdjustment(adjustment, windSpeed, temp);
                adjustment = applyUVAdjustment(adjustment, uvIndex);
                adjustment = applyInteractionEffects(adjustment, temp, humidity, uvIndex, windSpeed, acclimatizationScore);

                const hydrationAdjustment = calculateHydrationAdjustment(hydrationStatus);
                const workoutLengthAdjustment = calculateWorkoutLengthAdjustment(workoutLength);

                adjustment *= hydrationAdjustment * workoutLengthAdjustment;

                const paceParts = goalPace.split(':');
                let minutes = parseInt(paceParts[0]);
                let seconds = parseInt(paceParts[1]);
                let totalSeconds = (minutes * 60) + seconds;

                totalSeconds += totalSeconds * adjustment;

                minutes = Math.floor(totalSeconds / 60);
                seconds = Math.round(totalSeconds % 60);

                const adjustedPace = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;

                return { time, adjustedPace };
            });

            return adjustments;
        }

        async function calculateHourlyPaces() {
            const goalPace = document.getElementById('goalPace').value;
            const zipCode = document.getElementById('zipCode').value;
            const acclimatizationHours = parseFloat(document.getElementById('acclimatizationHours').value);
            const hydrationStatus = document.getElementById('hydrationStatus').value;
            const workoutLength = parseInt(document.getElementById('workoutLength').value);

            const hourlyData = await fetchHourlyWeatherData(zipCode);

            const adjustments = calculateHourlyAdjustments(goalPace, hourlyData, acclimatizationHours, hydrationStatus, workoutLength);

            renderChart(adjustments);
        }

        function renderChart(data) {
            const ctx = document.getElementById('adjustmentChart').getContext('2d');
            const labels = data.map(d => new Date(d.time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
            const adjustedPaces = data.map(d => parseFloat(d.adjustedPace.split(':').join('.'))); // Convert "min:sec" to decimal format for chart

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Adjusted Pace (min/mile)',
                        data: adjustedPaces,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        fill: false,
                    }]
                },
                options: {
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'hour',
                                tooltipFormat: 'HH:mm'
                            }
                        }
                    }
                }
            });
        }

        // Set current date as default value
        document.getElementById('date').value = new Date().toISOString().substring(0, 10);

        function applyTheme() {
            const themes = [
                { bg: '#E0F7FA', fg: '#0B032D', button: '#D88C9A', secondary: '#0B032D' },
                { bg: '#FFF8E1', fg: '#0B032D', button: '#0267C1', secondary: '#0B032D' },
                { bg: '#FFCDD2', fg: '#0B032D', button: '#0267C1', secondary: '#0B032D' },
                { bg: '#DCEDC8', fg: '#0B032D', button: '#0267C1', secondary: '#0B032D' },
                { bg: '#F0F4C3', fg: '#0B032D', button: '#0267C1', secondary: '#0B032D' }
            ];

            const now = new Date();
            const seconds = now.getSeconds();
            let themeIndex;

            if (seconds % 5 === 0) {
                themeIndex = 4;
            } else if (seconds % 7 === 0) {
                themeIndex = 3;
            } else if (seconds % 5 === 0) {
                themeIndex = 2;
            } else if (seconds % 3 === 0) {
                themeIndex = 1;
            } else {
                themeIndex = 0;
            }

            const theme = themes[themeIndex];
            document.body.style.backgroundColor = theme.bg;
            document.body.style.color = theme.fg;
            document.querySelector('.container').style.backgroundColor = 'white'; /* Always white */
            document.querySelector('h1').style.color = theme.secondary;
            document.querySelectorAll('label').forEach(label => label.style.color = theme.secondary);
            document.querySelectorAll('input, select').forEach(input => input.style.backgroundColor = '#EDEDED');
            document.querySelectorAll('button').forEach(button => {
                button.style.backgroundColor = theme.button;
                button.style.color = 'white';
            });
            document.querySelectorAll('#result, .weather-info').forEach(div => {
                div.style.backgroundColor = '#e0f2f1';
                div.style.color = theme.secondary;
            });
            document.querySelectorAll('.credits').forEach(credit => credit.style.color = theme.secondary);
            document.querySelectorAll('.credits a').forEach(a => a.style.color = theme.button);
        }
    </script>
</body>
</html>
